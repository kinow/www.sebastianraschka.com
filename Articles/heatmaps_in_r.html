<!DOCTYPE html>
<html>
<head>
<link rel="image_src" href="http://media.clickonf5.org/image/logo.png" />
		<!--META-->
		<meta name="description" content="A short tutorial for decent heat maps in R.">
		<meta name="Author" content="Sebastian Raschka">
		<title>A short tutorial for decent heat maps in R</title>

		<!-- jQuery -->
		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
		<script type="text/javascript" src="../jQuery/main_app.js"></script>
		<script type="text/javascript" src=" ../jQuery/index.js"></script>

		<!-- CSS -->
		<link rel="stylesheet" type="text/css" href="../CSS/main.css" media="screen" />
		<link rel="stylesheet" type="text/css" href="../CSS/content.css" media="screen" />
</head>
<body>

	<div id ='container' >

		<div id ='header_new'>
		             
				<a href = "../index.html"><img src="../Images/title_text.png" style="border-style:none"/></a>	
				<hr>
				<div align="right" style="padding-right:20px">
					<a href = "../articles.html" class ="menubar"><font color="#6495ED">blog</font></a> &#8226;
					<a href = "../webapps.html" class ="menubar">webapps</a> &#8226;
					<a href = "../software.html" class ="menubar">software</a> &#8226;
					<a href = "../publications.html" class ="menubar">books</a> &#8226;
					<a href = "../contact.html" class ="menubar">about+contact</a> 
					 
				</div>
				<hr>
		</div> <!--close header -->
	</div><!--close container -->


		<div id ='content'>
			
		


			<div id ='main'>

                <h2 class="article_top">A short tutorial for decent heat maps in R</h2>
					<p id="article_header"><em>-- written by Sebastian Raschka</em> on December 8, 2013</p>

	<!-- START Twitter API -->
        		 <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://bit.ly/1giekhj" 
                counturl="http://groups.google.com/group/ZEsjUY"
        		 data-count="none" data-via="rasbt"
        		 data-text="A short tutorial for decent heat maps in R" data-lang="en">Tweet</a>

        		<script>!function(d,s,id){var
        		js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
	<!-- END Twitter API -->  <br> 
 

<style type="text/css">
code {
   font-size: 13.5px;
   color: #000099;
}
</style>

				<div class="article" style="font-size: 16px;">
		<div style="padding-right:70px">
		  <p style="line-height:1.7"><strong>
I received many questions from people who want to quickly visualize their data via heat maps - ideally as quickly as possible. This is the major issue of exploratory data analysis, since we often don&#8217;t have the time to digest whole books about the particular techniques in different software packages to just get the job done.<br>
But once we are happy with our initial results, it might be worthwhile to dig deeper into the topic in order to further customize our plots and maybe even polish them for publication. In this post, my aim is to briefly introduce one of R&#8217;s several heat map libraries for a simple data analysis.<br>
I chose R, because it is one of the most popular free statistical software packages around. Of course there are many more tools out there to produce similar results (and even in R there are many different packages for heat maps), but I will leave this as an open topic for another time. </strong></p></div>

<div style="width: 400px;">
  <hr>
</div>
<div style="width: 600px; margin-left:60px;">
<h4>Sections</h4>

<p><a href="#script">Script overview</a><br>
<a href="#running_script">Running a script in R</a><br>
<a href="#script_details">Script parameters in more detail</a><br>
 &nbsp;&nbsp;&nbsp;&nbsp;<a href="#installing">A) Installing and loading required packages</a><br>
 &nbsp;&nbsp;&nbsp;&nbsp;<a href="#reading">B) Reading in data and transform it into matrix format</a><br>
 &nbsp;&nbsp;&nbsp;&nbsp;<a href="#customizing">C) Customizing and plotting the heat map</a><br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#color">Optional: Choosing custom color palettes and color breaks</a><br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#png">Optional: Saving the heat map as PNG file</a><br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#plotting">Plotting the heat map</a><br>
<a href="#clustering">Clustering Methods</a><br>
<a href="#categorizing">Categorizing Measurement Variables</a><br>


</p>
</div>

<div style="width: 400px;">
  <hr>
</div>		
<br>
<p><b>The files that I used can be downloaded from here:</b><br>
Example dataset: <a href="https://raw.github.com/rasbt/tutorials_cheatsheets/master/datasets/heatmaps_in_r.csv">heatmaps_in_r.csv</a><br>
R script: <a href="https://raw.github.com/rasbt/tutorials_cheatsheets/master/scripts/heatmaps_in_r.R">heatmaps_in_r.R</a><br></p>
<br>
<br>
<br>

<img src="../Images/heatmaps_in_r.png" alt="heatmap.png" title="heatmap.png" />




<p>Following this paragraph you see the whole shebang so that you know what you are dealing with: An R script that uses R&#8217;s <code>gplot</code> package to create heat maps via the <code>heatmap.2()</code> function.
<br>It might look gargantuan considering that we "only" want to create a simple heat map, but don&#8217;t worry, many of the parameters are not required, and I will discuss the details in the following sections. </p>
<br>
<br>

<p><a name="script"></a></p>

<h1>Script overview</h1>
<br>
<br>

<img src="../Images/heatmaps_in_r3.png" alt="heatmapcode.png" title="heatmapcode.png" /> 
<br>
<br>
<a href="https://raw.github.com/rasbt/tutorials_cheatsheets/master/scripts/heatmaps_in_r.R">(download the script)</a></p>
<br>
<br>

<p><a name="running_script"></a></p>

<h1>Running a script in R</h1>

<p>To run a script in R, start a new R session by either typing R into a shell terminal, or execute R from you Applications folder. Now, you can type the following command in R to execute a script:
<pre>source("path/to/the/script/heatmaps_in_R.R")</pre></p>

<p><a name="script_details"></a></p>
<br>
<br>

<h1>Script parameters in more detail</h1>
<br>
<p><a name="installing"></a></p>

<h3>A) Installing and loading required packages</h3>

<p>At first glance, this section might look a little bit more complicated then it need be, since executing <code>library(packagename)</code> is already sufficient to load required R packages if they are already installed.
<pre>
if (!require("gplots")) {
 install.packages("gplots", dependencies = TRUE)
 library(gplots)
 }
if (!require("RColorBrewer")) {
 install.packages("RColorBrewer", dependencies = TRUE)
 library(RColorBrewer)
 }
</pre>
The lines preceding the <code>library()</code> command are only there for convenience, to ensure that we will be prompted to install the required packages if we haven&#8217;t set them up previously yet.<br>
We are importing the <code>gplot</code> package to call the function <code>heatmap.2()</code> as we will see in the later sections. There are a bunch of other options to create heat maps in R, such as R&#8217;s basic <code>heatmap()</code> function and functions from the <code>ggplot2</code> package.<br>
I simply chose <code>heatmap.2()</code> here because it offers some nice extra features over R&#8217;s in-built <code>heatmap()</code> function, such as a color legend, but follows the same familiar syntax.
The <code>RColorBrewer</code> package is more optional, and we will use it to make our own color palette for the heat map via the <code>colorRampPalette()</code> function.</p>

<p><a name="reading"></a></p>
<br>
<br>

<h3>B) Reading in data and transform it into matrix format</h3>

<p>We can feed in our data into R from many different data file formats, including ASCII formatted text files, Excel spreadsheets and so on. For this tutorial, we assume that our data is formatted as Comma-Separated Values (CSV); probably one of the most common data file formats.<br><br>
<img src="../Images/heatmaps_in_r_2.png" alt="" />
<br><br>
When we open the CSV file in our favorite plain text editor instead of using a spread sheet program (Excel, Numbers, etc.), it looks like this:
</p>

<pre>#heat map example data set,,,,
#12/08/13 sr,,,,#

,var1,var2,var3,var4
measurement1,0.094,0.668,0.4153,0.4613
measurement2,0.1138,&#8211;0.3847,0.2671,0.1529
measurement3,0.1893,0.3303,0.5821,0.2632
measurement4,&#8211;0.0102,&#8211;0.4259,&#8211;0.5967,0.18
measurement5,0.1587,0.2948,0.153,&#8211;0.2208
measurement6,&#8211;0.4558,0.2244,0.6619,0.0457
measurement7,&#8211;0.6241,&#8211;0.3119,0.3642,0.2003
measurement8,&#8211;0.227,0.499,0.3067,0.3289
measurement9,0.7365,&#8211;0.0872,&#8211;0.069,&#8211;0.4252
measurement10,0.9761,0.4355,0.8663,0.8107
</pre>
<a href="https://raw.github.com/rasbt/tutorials_cheatsheets/master/datasets/heatmaps_in_r.csv">(download the CSV file)</a></p>

<p>When we are reading the data from our CSV file into R and assign it to the variable <code>data</code>, note the two lines of comments preceding the main data in our CSV file, indicated by an octothorpe (#) character. Since we don&#8217;t need those lines to plot our heat map, we can ignore them by via the <code>comment.char</code> argument in the <code>read.csv()</code> function.
<pre>data &lt;- read.csv("../datasets/heatmaps_in_r.csv", comment.char="#")</pre></p>

<p>One tricky part of the <code>heatmap.2()</code> function is that it requires the data in a numerical matrix format in order to plot it. By default, data that we read from files using R&#8217;s <code>read.table()</code> or <code>read.csv()</code> functions is stored in a <code>data table</code> format. The <code>matrix</code> format differs from the <code>data table</code> format by the fact that a <code>matrix</code> can only hold one type of data, e.g., numerical, strings, or logical.<br>
Fortunately, we don&#8217;t have to worry about the row that contains our column names (var1, var2, var3, var4) since the <code>read.csv()</code> function treats the first line of data as <code>table header</code> by default. But we would run into trouble if we want to include the row names (measurement1, measurment2, etc.) in our numerical matrix.<br>
For our own convenience, we store those row names in the first column as variable <code>rnames</code>, which we can use later to assign <code>row names</code> to our matrix after the conversion.
<pre> rnames &lt;- data[,1] </pre></p>

<p>Now, we transform the numerical data from the variable <code>data</code> (column 2 to 5) into a matrix and assign it to a new variable <code>mat_data</code>
<pre>mat_data &lt;- data.matrix(data[,2:ncol(data)])</pre>
Instead of using the rather fiddly expression <code>ncol(data)]</code>, which returns the total number of columns from the data table, we could also provide the integer 5 directly in order to specify the last column that we want to include. However, <code>ncol(data)]</code> is more convenient for larger data sets so that we don&#8217;t need to count all columns to get the index of the last column for specifying the upper boundary.<br>
Next, we assign the column names, which we have saved as <code>rnames</code> previously, to the matrix via
<pre>rownames(mat_data) &lt;- rnames </pre></p>

<p><a name="customizing"></a></p>
<br>
<br>

<h3>C) Customizing and plotting the heat map</h3>

<p>Finally, we have our data in the "right" format in order to create our heat map, but before we get down to business, let us have a brief look at some options for customization.</p>

<p><a name="color"></a></p>

<br>

<h4>Optional: Choosing custom color palettes and color breaks</h4>

<p>Instead of using the default colors of the <code>heatmap.2()</code> function, I want to show you how to use the <code>RColorBrewer</code> package for creating our own color palettes. Here, we go with the most popular choice for heat maps: A color range from green over yellow to red.
<pre>my_palette &lt;- colorRampPalette(c("red", "yellow", "green"))(n = 299)</pre>
There are many different ways to specify colors in R. I find it most convenient to assign colors by their name. A nice overview of the different color names in R can be found at <br> <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf</a> </p>

<p>The argument <code>(n = 299)</code> lets us define how many individuals colors we want to have in our palette. Obviously, the higher the number of individual colors, the smoother the transition will be; the number 299 should be sufficiently large enough for a smooth transition.<br>
By default, RColorBrewer will divide the colors evenly so that every color in our palette will be an interval of individual colors of similar size. However, sometimes we want to have a little skewed color range depending on the data we are analyzing.
Let&#8217;s assume that our example data set consists of Pearson correlation coefficients (i.e., R values) ranging from &#8211;1 to 1, and we are particularly interested in samples that have a (relatively) high correlation: R values in the range between 0.8 to 1.0. We want to highlight these samples in our heat map by only showing values from 0.8 to 1 in green. In this case, we can define our color breaks "unevenly" by using the following code:
<pre>
col_breaks = c(seq(&#8211;1,0,length=100), # for red
seq(0,0.8,length=100), # for yellow
seq(0.8,1,length=100)) # for green
</pre></p>

<p><a name="png"></a></p>
<br>
<br>

<h4>Optional: Saving the heat map as PNG file</h4>

<p>R supports a variety of different vector graphics formats, such as SVG, PostScript, and PDFs, and raster graphics (bitmaps) like JPEG, PNG, TIFF, BMP, etc. Each format comes with its own advantages and disadvantages, and depending on the particular purposes (websites, journal articles, PowerPoint presentations, archiving &#8230; ) we chose one file format over the other.<br>
I don&#8217;t want to discuss all the details about when to use which particular file format in this tutorial but instead use a more common PNG format for our heat map. I picked PNG instead of JPEG, because PNG offers lossless compression (JPEG is a lossy image format) at the small cost of a slightly larger file size.
However, you could completely omit the <code>png()</code> function in your script if you just want to show the heat map in an interactive screen in R.</p>

<pre>
png("../images/heatmaps_in_r.png",    # create PNG for the heat map        
width = 5*300,        # 5 x 300 pixels
height = 5*300,
res = 300,            # 300 pixels per inch
pointsize = 8)        # smaller font size
</pre>

<p>The default parameters of the <code>png()</code> function would yield a relatively small PNG file at very low resolution, which is not really practical for heat maps. Thus we provide additional arguments for the image <code>width</code>, <code>height</code> and the resolution.<br>
The units of <code>width</code> and <code>height</code> are pixels, not inches. So if we want to create a 5x5 inch image with 300 pixels per inch, we have to do a little math here: [1500 pixels] / [300 pixels/inch] = 5 inches. Also, we choose a slightly smaller font size of 8 pt.</p>

<p><b>Be careful to not forget to close the <code>png()</code> plotting device at the end of you script via the function
<code>dev.off()</code>
otherwise you probably won&#8217;t be able to open the PNG file to view it. </b></p>

<p><a name="plotting"></a></p>
<br>
<br>

<h4>Plotting the heat map</h4>

<p>Now, let&#8217;s get down to business and take a look at the <code>heatmap.2()</code> function:</p>

<pre>
heatmap.2(mat_data, 
  cellnote = mat_data,  # same data set for cell labels
  main = "Correlation", # heat map title
  notecol="black",      # change font color of cell labels to black
  density.info="none",  # turns off density plot inside color legend
  trace="none",         # turns off trace lines inside the heat map
  margins =c(12,9),     # widens margins around plot
  col=my_palette,       # use on color palette defined earlier 
  breaks=col_breaks,    # enable color transition at specified limits
  dendrogram="row",     # only draw a row dendrogram
  Colv="NA")            # turn off column clustering
  </pre>

<p>As you remember, the first argument is the variable <code>mat_data</code> contains our numerical matrix data, which we prepared from our data file.
This is the only argument that is required to plot a default heat map, all the other following lines are all optional.
I recommend you to call the function <code>help(heatmap.2)</code> in R to get a detailed list of all available parameters we are using (and not using) in our <code>heatmap.2()</code> function.
I hope that the comments in the code behind the different arguments are sufficient to explain their purpose. However, the <code>cellnote</code> might require a few more words. Via the <code>cellnote</code> parameter, we can show the individual values of our data in the cells of the heat maps. This can be either the same data matrix, or we can use a different data matrix of equal dimensions (for example the coefficient of determination R<sup>2</sup>)</p>



<p><a name="clustering"></a></p>
<br>
<br>


<h3> Update Feb 19, 2014 - Clustering Methods </h3>
If you want to change the default clustering method (complete linkage method with Euclidean distance measure), this can be done as follows:

For a square matrix, we can define the distance and cluster based on our matrix data by
<pre>
distance = dist(mat_data, method = "manhattan")
cluster = hclust(distance, method = "ward")
</pre>
And eventually plug it into the <code>heatmap.2()</code> function

<pre>

heatmap.2(mat_data, 
  ...
  Rowv = as.dendrogram(cluster), # apply default clustering method
  Colv = as.dendrogram(cluster)) # apply default clustering method
)
</pre>


Arguments for the <code>dist()</code> function are: <code>euclidean (default), maximum, canberra, binary, minkowski, manhattan</code> <br>
And arguments for <code>hclust(): complete (default), single, average, mcquitty, median, centroid, ward</code> <br>


Note that for non-square matrices you have to define the distance and cluster for both row and column dendrograms separately.
Otherwise you will get a not so pleasant <code>Error in x[rowInd, colInd] : subscript out of bounds.</code>

<br>

<pre>

row_distance = dist(mat_data, method = "manhattan")
row_cluster = hclust(row_distance, method = "ward")
col_distance = dist(t(mat_data), method = "manhattan")
col_cluster = hclust(col_distance, method = "ward")

heatmap.2(mat_data, 
  ...
  Rowv = as.dendrogram(row_cluster), # apply default clustering method
  Colv = as.dendrogram(col_cluster)) # apply default clustering method
)
</pre>


<p><a name="categorizing"></a></p>
<br>
<br>


<h3> Update Mar 2, 2014 - Categorizing Measurements </h3>
I was just asked how to categorize the input variables by applying row or column labels. For example, if we want to group the "measurement"
variables into 3 different categories: <br>
measurement 1-3 = category 1<br>
measurement 4-6 = category 2<br>
measurement 7-10 = category 3.<br>
My solution would be to simply provide <code>RowSideColors</code> as additional argument to the <code>heatmap.2()</code> function. E.g.,

<pre>heatmap.2(mat_data, 
  ...
  RowSideColors = c(    # grouping row-variables into different
     rep("gray", 3),   # categories, Measurement 1-3: green
     rep("blue", 3),    # Measurement 4-6: blue
     rep("black", 4)),    # Measurement 7-10: red
  ...
)
</pre>
Note that we could also provide similar labels to the column variables via the <code>ColSideColors</code> argument.
Another useful addition would be to add a color legend for our new category labels. The code for this particular example would be:
<pre>
par(lend = 1)           # square line ends for the color legend
legend("topright",      # location of the legend on the heatmap plot
    legend = c("category1", "category2", "category3"), # category labels
    col = c("gray", "blue", "black"),  # color key
    lty= 1,             # line style
    lwd = 10            # line width
)          
</pre>

The figure below shows how our modified heatmap would look like after we applied row categorization and provided a color legend:
<br>
<br>


<img src='../Images/heatmaps_in_r_categorizing.png'>


The complete scripts (ready to use) can be found at: <a href="https://github.com/rasbt/R_snippets/tree/master/heatmaps">https://github.com/rasbt/R_snippets/tree/master/heatmaps</a>
				  
	
		&nbsp;<br>
     	  &nbsp;<br>   
        
					
	

		</div> 	<!-- close article -->



			</div><!--close main -->
		
	</div><!--close content -->
	




<!-- START Footer -->

	<div id ='footer'>	
        <center>
	<hr>
        <div style="height:20px;"></div>
        <p>HTML and JavaScripts were written by Sebastian Raschka <br>
        Copyright (C) 2013-2014 Sebastian Raschka</p>


	<!-- START Twitter API -->

 <a href="https://twitter.com/rasbt" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @rasbt</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
	<!-- END Twitter API -->
<div style="height:20px;"></div>

	<hr>

     
        
		 <div style="height:10px;"></div>
		</center>
	</div>
<!-- END Footer -->


<!-- Start DISQUS -->

 <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'sebastianraschka'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


<!-- Start Google Analytics -->
		<script type="text/javascript">

  		var _gaq = _gaq || [];
  		_gaq.push(['_setAccount', 'UA-38457794-1']);
  		_gaq.push(['_trackPageview']);

  		(function() {
    	var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    	ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  		})();
		</script>
<!-- End  Google Analytics -->

</body>
</html>
